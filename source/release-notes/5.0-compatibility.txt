====================================
Compatibility Changes in MongoDB 5.0
====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The following 5.0 changes can affect compatibility with older
versions of MongoDB.


Removed Commands
----------------

Removed Parameters
------------------

.. include:: /includes/5.0-changes/removed-parameters.rst

Removed Metrics
---------------

Starting in MongoDB 5.0, the :dbcommand:`serverStatus` command does not
output :serverstatus:`opReadConcernCounters`, which contained the
:ref:`read concern level <read-concern-levels>` specified by query
operations. Instead, the new :serverstatus:`readConcernCounters`
replaces :serverstatus:`opReadConcernCounters` and contains additional
information.

Tools Changes
-------------

Replica Sets
------------

Manual Oplog Writes
~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 5.0, it is no longer possible to perform manual
write operations to the :doc:`oplog </core/replica-set-oplog>` on a
cluster running as a :ref:`replica set <replication>`. Performing write
operations to the oplog when running as a
:term:`standalone instance <standalone>` should only be done with
guidance from MongoDB Support.

Projection Compatibility Changes
--------------------------------

Map Reduce Changes
------------------

``listDatabases`` Output Changes
--------------------------------

Starting in MongoDB 5.0, output from the :dbcommand:`listDatabases` 
command running against a :binary:`~bin.mongod` is more consistent with 
output from :dbcommand:`listDatabases` running against a 
:binary:`~bin.mongos`.

The following table shows the differences in data types for
:dbcommand:`listDatabases` output fields between MongoDB 5.0 and earlier
versions. Only fields which differ between 5.0 and earlier versions are 
listed. 

.. list-table::
   :header-rows: 1
   :widths: 30 30 30 30
   
   * - Field
   
     - Type in MongoDB 5.0 

     - Type in MongoDB 4.4 and earlier (``mongod``)

     - Type in MongoDB 4.4 and earlier (``mongos``)
   
   * - ``sizeOnDisk``
   
     - integer
    
     - double

     - integer
   
   * - ``totalSize``
  
     - integer
   
     - double

     - integer
  
   * - ``totalSizeMb``
 
     - integer

     - not present (see below)

     - integer  

The output from :dbcommand:`listDatabases` now includes the 
``totalSizeMb`` field when run against either a :binary:`~bin.mongos` or 
a :binary:`~bin.mongod`. In MongoDB 4.4 and earlier, ``totalSizeMb`` 
only appears when run against :binary:`~bin.mongos`. ``totalSizeMb`` is 
the sum of the ``sizeOnDisk`` fields, expressed in megabytes.  

When run against :binary:`~bin.mongos`, the ``shards`` field in the
:dbcommand:`listDatabases` output contains a field-value pair for each
collection on a particular shard. Size values in the ``shards`` field 
are expressed as integers.

General Changes
---------------

- Starting in MongoDB 5.0, the :dbcommand:`reIndex` command and the
  :method:`db.collection.reIndex()` shell method may only be run on
  :term:`standalone` instances.

- Starting in MongoDB 5.0, the number of :doc:`aggregation pipeline
  stages </reference/operator/aggregation-pipeline>` allowed in a single
  pipeline is limited to 1000.

Deprecations
~~~~~~~~~~~~

Map Reduce
``````````

.. include:: /includes/5.0-mapReduce-deprecated.rst

5.0 Feature Compatibility
-------------------------
